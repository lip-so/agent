<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeRobot Setup Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 800px;
            width: 90%;
            margin: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .setup-step {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #ddd;
            transition: all 0.3s ease;
        }

        .setup-step.active {
            border-left-color: #007bff;
            background: #e3f2fd;
        }

        .setup-step.completed {
            border-left-color: #28a745;
            background: #e8f5e8;
        }

        .setup-step.error {
            border-left-color: #dc3545;
            background: #ffebee;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .step-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .status-pending {
            background: #e9ecef;
            color: #6c757d;
        }

        .status-running {
            background: #cce5ff;
            color: #0066cc;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .step-message {
            color: #666;
            margin-top: 10px;
            font-size: 0.95em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .ports-list {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }

        .port-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .port-item:hover {
            background: #f8f9fa;
        }

        .port-item.selected {
            background: #e3f2fd;
            color: #1976d2;
        }

        .config-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .robot-type-selector {
            display: flex;
            gap: 15px;
            margin: 15px 0;
        }

        .robot-type-option {
            flex: 1;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .robot-type-option.selected {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¤– LeRobot Setup Assistant</h1>
            <p>Automated setup for your LeRobot installation</p>
        </div>

        <!-- Step 1: Installation -->
        <div class="setup-step" id="step-installation">
            <div class="step-header">
                <div class="step-title">1. Install LeRobot</div>
                <div class="step-status status-pending" id="status-installation">Pending</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-installation" style="width: 0%"></div>
            </div>
            <div class="step-message" id="message-installation">Click Start Installation to begin</div>
            <button class="btn" id="btn-install" onclick="startInstallation()">Start Installation</button>
        </div>

        <!-- Step 2: Port Discovery -->
        <div class="setup-step" id="step-ports">
            <div class="step-header">
                <div class="step-title">2. Discover USB Ports</div>
                <div class="step-status status-pending" id="status-ports">Pending</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-ports" style="width: 0%"></div>
            </div>
            <div class="step-message" id="message-ports">Waiting for installation to complete</div>
            <div class="ports-list" id="ports-list" style="display: none;"></div>
            <button class="btn" id="btn-discover" onclick="discoverPorts()" disabled>Discover Ports</button>
        </div>

        <!-- Step 3: Motor Configuration -->
        <div class="setup-step" id="step-motors">
            <div class="step-header">
                <div class="step-title">3. Configure Motors</div>
                <div class="step-status status-pending" id="status-motors">Pending</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-motors" style="width: 0%"></div>
            </div>
            <div class="step-message" id="message-motors">Waiting for port discovery</div>
            
            <div class="config-section" id="motor-config" style="display: none;">
                <div class="robot-type-selector">
                    <div class="robot-type-option" id="type-follower" onclick="selectRobotType('follower')">
                        <h3>Follower Arm</h3>
                        <p>Main robotic arm</p>
                    </div>
                    <div class="robot-type-option" id="type-leader" onclick="selectRobotType('leader')">
                        <h3>Leader Arm</h3>
                        <p>Teleoperation arm</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="selected-port">Selected Port:</label>
                    <select id="selected-port">
                        <option value="">Select a port...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="robot-id">Robot ID:</label>
                    <input type="text" id="robot-id" placeholder="e.g., my_awesome_arm" />
                </div>
                
                <button class="btn" id="btn-setup-motors" onclick="setupMotors()" disabled>Setup Motors</button>
            </div>
        </div>

        <!-- Step 4: Calibration -->
        <div class="setup-step" id="step-calibration">
            <div class="step-header">
                <div class="step-title">4. Calibrate Robot</div>
                <div class="step-status status-pending" id="status-calibration">Pending</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-calibration" style="width: 0%"></div>
            </div>
            <div class="step-message" id="message-calibration">Waiting for motor configuration</div>
            <button class="btn" id="btn-calibrate" onclick="calibrateRobot()" disabled>Start Calibration</button>
        </div>
    </div>

    <script>
        let selectedPort = '';
        let selectedRobotType = '';
        let currentConfig = {};

        // Update status every 2 seconds
        setInterval(updateStatus, 2000);

        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    updateStepStatus('installation', data.installation);
                    updateStepStatus('ports', data.port_discovery);
                    updateStepStatus('motors', data.motor_config);
                    updateStepStatus('calibration', data.calibration);

                    // Update ports list if available
                    if (data.port_discovery.ports && data.port_discovery.ports.length > 0) {
                        updatePortsList(data.port_discovery.ports);
                    }

                    // Enable/disable buttons based on status
                    updateButtonStates(data);
                });
        }

        function updateStepStatus(step, statusData) {
            const stepElement = document.getElementById(`step-${step}`);
            const statusElement = document.getElementById(`status-${step}`);
            const progressElement = document.getElementById(`progress-${step}`);
            const messageElement = document.getElementById(`message-${step}`);

            // Update status text and styling
            statusElement.textContent = statusData.status.charAt(0).toUpperCase() + statusData.status.slice(1);
            statusElement.className = `step-status status-${statusData.status}`;

            // Update step styling
            stepElement.className = `setup-step ${statusData.status}`;

            // Update progress bar
            progressElement.style.width = `${statusData.progress}%`;

            // Update message
            if (statusData.status === 'running') {
                messageElement.innerHTML = `<div class="loading"><div class="spinner"></div>${statusData.message}</div>`;
            } else {
                messageElement.textContent = statusData.message;
            }
        }

        function updatePortsList(ports) {
            const portsList = document.getElementById('ports-list');
            const portSelect = document.getElementById('selected-port');
            
            portsList.innerHTML = '';
            portSelect.innerHTML = '<option value="">Select a port...</option>';
            
            ports.forEach(port => {
                // Add to visual list
                const portItem = document.createElement('div');
                portItem.className = 'port-item';
                portItem.textContent = port;
                portItem.onclick = () => selectPort(port);
                portsList.appendChild(portItem);

                // Add to select dropdown
                const option = document.createElement('option');
                option.value = port;
                option.textContent = port;
                portSelect.appendChild(option);
            });

            portsList.style.display = 'block';
            document.getElementById('motor-config').style.display = 'block';
        }

        function selectPort(port) {
            selectedPort = port;
            document.getElementById('selected-port').value = port;
            
            // Update visual selection
            document.querySelectorAll('.port-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent === port) {
                    item.classList.add('selected');
                }
            });

            updateMotorSetupButton();
        }

        function selectRobotType(type) {
            selectedRobotType = type;
            
            // Update visual selection
            document.querySelectorAll('.robot-type-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(`type-${type}`).classList.add('selected');

            // Set default robot ID
            document.getElementById('robot-id').value = `my_awesome_${type}_arm`;

            updateMotorSetupButton();
        }

        function updateMotorSetupButton() {
            const button = document.getElementById('btn-setup-motors');
            button.disabled = !(selectedPort && selectedRobotType);
        }

        function updateButtonStates(data) {
            // Installation button
            document.getElementById('btn-install').disabled = 
                data.installation.status === 'running' || data.installation.status === 'completed';

            // Discover ports button
            document.getElementById('btn-discover').disabled = 
                data.installation.status !== 'completed' || data.port_discovery.status === 'running';

            // Setup motors button
            const motorButton = document.getElementById('btn-setup-motors');
            motorButton.disabled = 
                data.port_discovery.status !== 'completed' || 
                data.motor_config.status === 'running' ||
                !selectedPort || !selectedRobotType;

            // Calibration button
            document.getElementById('btn-calibrate').disabled = 
                data.motor_config.status !== 'completed' || data.calibration.status === 'running';
        }

        function startInstallation() {
            fetch('/api/install', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    console.log('Installation started:', data);
                });
        }

        function discoverPorts() {
            fetch('/api/discover_ports', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    console.log('Port discovery started:', data);
                });
        }

        function setupMotors() {
            const robotId = document.getElementById('robot-id').value || `my_awesome_${selectedRobotType}_arm`;
            
            fetch('/api/setup_motors', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    robot_type: selectedRobotType,
                    port: selectedPort,
                    robot_id: robotId
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Motor setup started:', data);
                currentConfig = { robot_type: selectedRobotType, port: selectedPort, robot_id: robotId };
            });
        }

        function calibrateRobot() {
            fetch('/api/calibrate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(currentConfig)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Calibration started:', data);
            });
        }

        // Initial status check
        updateStatus();
    </script>
</body>
</html> 